<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ma Frise Chronologique</title>
    <link href="https://unpkg.com/vis-timeline@7.4.4/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/vis-timeline@7.4.4/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        #timeline {
            position: sticky;
            width: 100%;
            height: 840px;
            overflow-y: hidden;
            overflow-x: auto;
            background-color: #fefaf0;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Cooper', Arial, sans-serif;
        }
        .vis-time-axis .vis-grid.vis-vertical { border-color: transparent; }
        .vis-labelset .vis-label { display: none; }
        .vis-group, .vis-line { border: none; }
        .vis-background { border-bottom: none; }
        .type-dirigeant {
            background-color: #f4e1d2;
            border: 2px solid #d1a684;
            border-radius: 10px;
            padding: 0px;
            font-family: 'Cooper', sans-serif;
            font-weight: bold;
            color: #3b2b1e;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 10px;
            transition: font-size 0.3s ease;
        }
        .type-archi {
            background-color: #f4b6b6;
            border: 2px solid #d17373;
            border-radius: 10px;
            padding: 0px;
            font-family: 'Cooper', sans-serif;
            font-weight: bold;
            color: #3b1e1e;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 10px;
            transition: font-size 0.3s ease;
        }
        .type-default {
            background-color: #d1a684;
            border-radius: 10px;
            padding: 0px;
            font-family: 'Cooper', sans-serif;
            font-weight: bold;
            color: #3b2b1e;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 10px;
            transition: font-size 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="timeline"></div>
    <script>
        Papa.parse("https://raw.githubusercontent.com/ines0011/frise/refs/heads/main/Official%20TimelineJS3%20Template.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const eraColors = [
                    'rgba(139, 69, 19, 0.3)',
                    'rgba(160, 82, 45, 0.3)',
                    'rgba(205, 133, 63, 0.3)',
                    'rgba(222, 184, 135, 0.3)',
                    'rgba(245, 222, 179, 0.3)'
                ];

                var items = results.data.map((row, index) => {
                    let yearText = row['Year'].trim();
                    let year = parseInt(yearText);
                    let date;
                    if (yearText.startsWith('-')) {
                        date = new Date(0, 0, 1);
                        date.setFullYear(year);
                    } else if (year < 100) {
                        date = new Date(year, 0, 1);
                        date.setFullYear(year);
                    } else {
                        date = new Date(year, 0, 1);
                    }

                    let endDateText = row['End Year'] ? row['End Year'].trim() : null;
                    let endDate = endDateText ? parseInt(endDateText) : null;
                    let endDateObj = endDateText ? new Date(Math.abs(endDate), 0, 1) : null;
                    if (endDateText && endDateText.startsWith('-')) {
                        endDateObj = new Date(0, 0, 1);
                        endDateObj.setFullYear(endDate);
                    } else if (endDateObj && endDate < 100) {
                        endDateObj.setFullYear(endDate);
                    }

                    let typeClass = {
                        'Dirigeant': 'type-dirigeant',
                        'Archi': 'type-archi'
                    }[row['Type']] || 'type-default';

                    let borderStyle = endDateObj ? 'none' : (typeClass === 'type-dirigeant' ? '2px solid #d1a684' : '2px solid #d17373');

                    if (row['Type'] === 'Ere' && endDateObj) {
                        return {
                            id: index + 1,
                            content: `<div style="padding: 5px; color: black; font-weight: bold;">${row['Headline']}</div>`,
                            start: date,
                            end: endDateObj,
                            type: 'background',
                            style: `background-color: ${eraColors[index % eraColors.length]};`
                        };
                    } else {
                        return {
                            id: index + 1,
                            content: `${row['Headline']}`,
                            start: date,
                            end: endDateObj,
                            group: row['Type'] || 'default',
                            className: typeClass,
                            title: `${row['Text']} (${yearText})`,
                            style: `border: ${borderStyle};`
                        };
                    }
                });

                var groups = new vis.DataSet([
                    { id: 'Ere', content: 'Ere' },
                    { id: 'Archi', content: 'Archi' },
                    { id: 'default', content: 'Autre' },
                    { id: 'Dirigeant', content: 'Dirigeant' }
                ]);

                var options = {
                    groupOrder: function (a, b) {
                        return a.id === 'Ere' ? 1 : -1;
                    },
                    start: new Date(-15000, 0, 1),
                    end: new Date(3000, 0, 1),
                    zoomMin: 1000 * 60 * 60 * 24 * 365,
                    zoomMax: 1000 * 60 * 60 * 24 * 365 * 15000,
                    width: '100%',
                    height: '840px',
                    margin: { item: 1, axis: 10 },
                    verticalScroll: false,
                    maxHeight: '100%',
                    format: {
                        minorLabels: { year: 'YYYY' },
                        majorLabels: { year: '' }
                    }
                };

                var timeline = new vis.Timeline(document.getElementById('timeline'), items, options);
                timeline.setGroups(groups);

                timeline.setWindow(new Date(-1500, 0, 1), new Date(1750, 0, 1));

                timeline.on('rangechange', function (properties) {
                    const currentRange = properties.end - properties.start;
                    items.forEach((item) => {
                        const element = document.querySelector(`[data-id='${item.id}']`);
                        if (element) {
                            if (currentRange > 500 * 365 * 24 * 60 * 60 * 1000) {
                                element.style.fontSize = '8px';
                                element.style.display = 'none';
                            } else {
                                element.style.fontSize = '10px';
                                element.style.display = 'block';
                            }
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
