<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ma Frise Chronologique</title>
    <link href="https://unpkg.com/vis-timeline@7.4.4/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/vis-timeline@7.4.4/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        #timeline {
    position: sticky;
    width: 100%;
    height: 800px;
    overflow-y: hidden; /* Cache le défilement vertical */
    overflow-x: auto; /* Permet un défilement horizontal pour les dates */
    background-color: #fefaf0;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Cooper', Arial, sans-serif;
        }

        /* Suppression du quadrillage */
        .vis-time-axis .vis-grid.vis-vertical {
            border-color: transparent;
        }

        /* Suppression des étiquettes de groupes */
        .vis-labelset .vis-label {
            display: none;
        }

        /* Suppression des lignes de groupes */
        .vis-group, .vis-line {
            border: none;
        }

        .vis-background {
            border-bottom: none;
        }

        /* Couleurs spécifiques par type */
        .type-dirigeant,
        .type-default {
            background-color: #f4e1d2;
            border: 2px solid #d1a684;
            border-radius: 10px;
            padding: 0px 0px;
            font-family: 'Cooper', sans-serif;
            font-weight: bold;
            color: #3b2b1e;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 10px;
        }
        .type-archi {
            background-color: #f4b6b6;
            border: 2px solid #d17373;
            border-radius: 10px;
            padding: 0px 0px;
            font-family: 'Cooper', sans-serif;
            font-weight: bold;
            color: #3b1e1e;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div id="timeline"></div>
    <script>
        Papa.parse("https://raw.githubusercontent.com/ines0011/frise/refs/heads/main/Official%20TimelineJS3%20Template.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const eraColors = [
                    'rgba(139, 69, 19, 0.3)',    // SaddleBrown
                    'rgba(160, 82, 45, 0.3)',    // Sienna
                    'rgba(205, 133, 63, 0.3)',   // Peru
                    'rgba(222, 184, 135, 0.3)',  // BurlyWood
                    'rgba(245, 222, 179, 0.3)'   // Wheat
                ];

                var items = results.data.map((row, index) => {
                    let yearText = row['Year'].trim();
                    let year = parseInt(yearText);
                    let date;
                    if (yearText.startsWith('-')) {
                        date = new Date(0, 0, 1);
                        date.setFullYear(year);  // années négatives
                    } else if (year < 100) {
                        date = new Date(year, 0, 1);
                        date.setFullYear(year); // pour éviter l'an 1900 par défaut
                    } else {
                        date = new Date(year, 0, 1);
                    }

                    let endDateText = row['End Year'] ? row['End Year'].trim() : null;
                    let endDate = endDateText ? parseInt(endDateText) : null;
                    let endDateObj = endDateText ? new Date(Math.abs(endDate), 0, 1) : null;
                    if (endDateText && endDateText.startsWith('-')) {
                        endDateObj = new Date(0, 0, 1);
                        endDateObj.setFullYear(endDate);
                    } else if (endDateObj && endDate < 100) {
                        endDateObj.setFullYear(endDate);
                    }

                    if (row['Type'] === 'Ere' && endDateObj) {
                        return {
                            id: index + 1,
                            content: `<div style="padding: 5px; color: black; font-weight: bold;">${row['Headline']}</div>`,
                            start: date,
                            end: endDateObj,
                            type: 'background',
                            style: `background-color: ${eraColors[index % eraColors.length]};`
                        };
                    } else {
                        let typeClass = {
                            'Dirigeant': 'type-dirigeant',
                            'Archi': 'type-archi'
                        }[row['Type']] || 'type-default';

                        return {
                            id: index + 1,
                            content: `${row['Headline']}`, // Affiche l'évènement
                            start: date,
                            end: endDateObj,
                            group: row['Type'] || 'default',
                            className: typeClass,
                            title: `${row['Text']} (${yearText})` // Affiche l'étiquette entière avec la date au survol
                        };
                    }
                });

                var groups = new vis.DataSet([
                    { id: 'Ere', content: 'Ere' },
                    { id: 'Dirigeant', content: 'Dirigeant' },
                    { id: 'Archi', content: 'Archi' },
                    { id: 'default', content: 'Autre' }
                ]);

                var options = {
                    start: new Date(-15000, 0, 1),
                    end: new Date(3000, 0, 1),
                    zoomMin: 1000 * 60 * 60 * 24 * 365,
                    zoomMax: 1000 * 60 * 60 * 24 * 365 * 15000,
                    width: '100%',
                    height: '800px',
                    margin: { item: 1, axis: 10 },
                    verticalScroll: false,
                    maxHeight: '100%',
                    format: {
                        minorLabels: { year: 'YYYY' },
                        majorLabels: { year: '' }
                    }
                };

                var timeline = new vis.Timeline(document.getElementById('timeline'), items, options);
                timeline.setGroups(groups);

                timeline.setWindow(new Date(-2000, 0, 1), new Date(1750, 0, 1));
            }
        });
    </script>
</body>
</html>
